# üöÄ –ë—ã—Å—Ç—Ä—ã–π –¥–µ–ø–ª–æ–π –Ω–∞ Production

## –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å–∫ —Å —Å–µ—Ä–≤–µ—Ä–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–¥–µ–ª–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑):

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@80.93.62.160

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
cd /var/www/uniform-factory
nano update.sh
```

–í—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `update-production.sh` –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ (Ctrl+O, Enter, Ctrl+X).

–ó–∞—Ç–µ–º —Å–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x update.sh
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ production (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π):

```bash
ssh root@80.93.62.160 "cd /var/www/uniform-factory && ./update.sh"
```

–ò–ª–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
ssh root@80.93.62.160
cd /var/www/uniform-factory
./update.sh
```

---

## –í–∞—Ä–∏–∞–Ω—Ç 2: –î–µ–ø–ª–æ–π —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞

### –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–¥–µ–ª–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑):

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ SSH –∫–ª—é—á –¥–ª—è –≤—Ö–æ–¥–∞ –±–µ–∑ –ø–∞—Ä–æ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```bash
# –ù–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
ssh-copy-id root@80.93.62.160
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ production (–æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π):

```bash
./deploy-from-local.sh
```

---

## –í–∞—Ä–∏–∞–Ω—Ç 3: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å–ø–æ—Å–æ–± (–±–µ–∑ —Å–∫—Ä–∏–ø—Ç–∞)

```bash
ssh root@80.93.62.160

cd /var/www/uniform-factory && \
cp backend/avik_uniform.db backend/avik_uniform.db.backup_$(date +%Y%m%d_%H%M%S) && \
git pull origin main && \
cd backend && source venv/bin/activate && \
pip install -r requirements.txt && \
sudo supervisorctl restart uniform-backend && \
cd ../frontend && yarn build && \
sudo systemctl reload nginx && \
echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"
```

---

## üìã –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

1. ‚úÖ **–°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. ‚úÖ **–ü–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** –∏–∑ GitHub (git pull)
3. ‚úÖ **–û–±–Ω–æ–≤–ª—è–µ—Ç backend** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (pip install)
4. ‚úÖ **–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç backend** —Å–µ—Ä–≤–∏—Å (supervisorctl restart)
5. ‚úÖ **–°–æ–±–∏—Ä–∞–µ—Ç frontend** (yarn build)
6. ‚úÖ **–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç Nginx** (systemctl reload)

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

1. **–û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞**: `Ctrl+Shift+R` (Windows/Linux) –∏–ª–∏ `Cmd+Shift+R` (Mac)
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç**: https://uniformfactory.ru
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥–º–∏–Ω–∫—É**: https://uniformfactory.ru/admin

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:

```bash
# Backend –ª–æ–≥–∏
tail -f /var/log/uniform-backend.err.log

# Nginx –ª–æ–≥–∏
tail -f /var/log/nginx/error.log

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
sudo supervisorctl status
```

---

## üîÑ –û—Ç–∫–∞—Ç –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:

–ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å:

```bash
cd /var/www/uniform-factory/backend

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤
ls -lh avik_uniform.db.backup_*

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω—É–∂–Ω—ã–π –±—ç–∫–∞–ø (–∑–∞–º–µ–Ω–∏—Ç–µ –¥–∞—Ç—É/–≤—Ä–µ–º—è)
cp avik_uniform.db.backup_20250105_191000 avik_uniform.db

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend
sudo supervisorctl restart uniform-backend
```

–û—Ç–∫–∞—Ç –∫–æ–¥–∞:

```bash
cd /var/www/uniform-factory

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤
git log --oneline -10

# –û—Ç–∫–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∫–æ–º–º–∏—Ç—É (–∑–∞–º–µ–Ω–∏—Ç–µ HASH)
git reset --hard HASH

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ frontend
cd frontend && yarn build && sudo systemctl reload nginx
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
free -h

# –ü—Ä–æ—Ü–µ—Å—Å—ã
htop

# –†–∞–∑–º–µ—Ä –±—ç–∫–∞–ø–æ–≤
du -sh backend/avik_uniform.db.backup_*
```

---

## üßπ –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤:

```bash
cd /var/www/uniform-factory/backend

# –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –±—ç–∫–∞–ø–æ–≤
ls -t avik_uniform.db.backup_* | tail -n +11 | xargs rm -f
```

---

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Cron (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—É—é –Ω–æ—á—å –≤ 3:00:

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ crontab
crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É:
0 3 * * * cd /var/www/uniform-factory && ./update.sh >> /var/log/uniform-update.log 2>&1
```

---

## üí° Pro-tip: –ê–ª–∏–∞—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–µ–ø–ª–æ—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `~/.bashrc` –∏–ª–∏ `~/.zshrc`:

```bash
alias deploy-uniform='ssh root@80.93.62.160 "cd /var/www/uniform-factory && ./update.sh"'
```

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:

```bash
deploy-uniform
```

---

**–í–æ–ø—Ä–æ—Å—ã?** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `PRODUCTION_UPDATE_GUIDE.md` –∏–ª–∏ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞.
